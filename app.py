import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
import json
import os
from evaluator.text_analyzer import TextAnalyzer
from evaluator.scorer import SamhallScorer

# ==========================================
# 1. ã‚°ãƒ©ãƒ•ä½œæˆãƒ»ä¿å­˜æ©Ÿèƒ½
# ==========================================
def create_radar_chart(scores):
    categories = list(scores.keys())
    values = list(scores.values())
    fig = go.Figure()
    fig.add_trace(go.Scatterpolar(r=values, theta=categories, fill='toself', name='ã‚¹ã‚­ãƒ«è©•ä¾¡'))
    fig.update_layout(
        polar=dict(radialaxis=dict(visible=True, range=[0, 2])),
        showlegend=False
    )
    return fig

def create_job_match_chart(job_matches):
    df = pd.DataFrame(job_matches)
    fig = px.bar(df, x='match_rate', y='job_name', orientation='h',
                 title="è·ç¨®ãƒãƒƒãƒãƒ³ã‚°ç‡",
                 labels={'match_rate': 'ãƒãƒƒãƒãƒ³ã‚°ç‡ (%)', 'job_name': 'è·ç¨®'})
    fig.update_layout(yaxis={'categoryorder':'total ascending'})
    return fig

# ==========================================
# 2. åˆæœŸè¨­å®šãƒ»èª¬æ˜æ–‡
# ==========================================
st.set_page_config(page_title="O-lys AIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ", layout="wide")

st.title("ğŸ¯ O-lys AIè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ24è·ç¨®å¯¾å¿œï¼‰")

st.markdown("""
### ğŸ“Œ æœ¬ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦
æœ¬ã‚¢ãƒ—ãƒªã¯ã€åŠ´åƒèƒ½åŠ›è©•ä¾¡ãƒ¡ã‚½ãƒƒãƒ‰**ã€ŒO-lysï¼ˆã‚ªãƒ¼ãƒªã‚¹ï¼‰ã€**ã®æŒ‡æ¨™ã«åŸºã¥ãã€å€‹äººã®ã€Œã§ãã‚‹ã“ã¨ã€ã‚’å¯è¦–åŒ–ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚

* **ãƒ’ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹**: 15ã®è©•ä¾¡é …ç›®ã‹ã‚‰ã€24è·ç¨®ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚
* **å‚è€ƒæŒ‡æ¨™**: ç‹¬è‡ªé–‹ç™ºã®ãƒ†ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚æ”¯æ´ã®æ–¹å‘æ€§ã‚’æ¤œè¨ã™ã‚‹ãŸã‚ã®å‚è€ƒã¨ã—ã¦ã”æ´»ç”¨ãã ã•ã„ã€‚

### ğŸ”’ å®‰å¿ƒãƒ»å®‰å…¨ã¸ã®å–ã‚Šçµ„ã¿
* **åŒ¿åã§åˆ†æ**: æ°åãªã©ã®å€‹äººæƒ…å ±ã¯åˆ†æã«ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚
* **å›ç­”æ–‡ã®ã¿ã‚’åˆ¤å®š**: èª²é¡Œã®ã€Œå›ç­”å†…å®¹ã€ã ã‘ã‚’å®‰å…¨ã«ã‚¹ã‚³ã‚¢åŒ–ã—ã¾ã™ã€‚
* **ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·**: å…¥åŠ›å†…å®¹ãŒå¤–éƒ¨ã®AIå­¦ç¿’ã«åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
""")

# ==========================================
# 3. ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆåŸºæœ¬æƒ…å ±å…¥åŠ›ï¼‰
# ==========================================
with st.sidebar:
    st.header("ğŸ“ åŸºæœ¬æƒ…å ±")
    name = st.text_input("æ°å", value="")
    age = st.number_input("å¹´é½¢", min_value=15, max_value=100, value=25)
    gender = st.selectbox("æ€§åˆ¥", ["ç”·æ€§", "å¥³æ€§", "ãã®ä»–"])
    disability_type = st.text_input("éšœå®³ç¨®åˆ¥", value="")
    st.info("â€»å…¥åŠ›ã•ã‚ŒãŸå€‹äººæƒ…å ±ã¯AIã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚")

# ==========================================
# 4. ãƒ¯ãƒ¼ã‚¯å›ç­”ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¸æŠè‚¢ï¼‹è¨˜è¿°ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰
# ==========================================
st.header("âœï¸ ãƒ†ã‚­ã‚¹ãƒˆèª²é¡Œ")
tab1, tab2, tab3, tab4 = st.tabs(["ğŸ“– èª­è§£ãƒ»ç†è§£", "âœï¸ æ–‡ç« ä½œæˆ", "ğŸ”¢ è¨ˆç®—ãƒ»è«–ç†", "ğŸ’¬ å ±å‘Šãƒ»ç›¸è«‡"])

text_responses = {}

with tab1:
    st.subheader("èª­è§£ãƒ»ç†è§£åŠ›")
    st.write("ã€èª²é¡Œã€‘æŒ‡ç¤ºæ›¸ï¼šã€ä½œæ¥­å‰ã«å¿…ãšå®‰å…¨é´ã‚’å±¥ãã€ãƒã‚±ãƒ„ã«3åˆ†ã®1ã®æ°´ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚ã€")
    r_sel = st.selectbox("æŒ‡ç¤ºã®å†…å®¹ã¯ã©ã®ãã‚‰ã„ç†è§£ã§ãã¾ã—ãŸã‹ï¼Ÿ", 
                           ["-- é¸æŠã—ã¦ãã ã•ã„ --", "å®Œç’§ã«ç†è§£ã—ãŸ", "ã ã„ãŸã„ç†è§£ã—ãŸ", "å°‘ã—ä¸å®‰ãŒã‚ã‚‹", "å…¨ãã‚ã‚ã‹ã‚‰ãªã‹ã£ãŸ"], key="r_s")
    r_txt = st.text_area("ã€è¨˜è¿°ã€‘å…·ä½“çš„ã«ã€ã¾ãšä½•ã‚’æº–å‚™ã—ã¾ã™ã‹ï¼Ÿ", placeholder="ä¾‹ï¼šå®‰å…¨é´ã‚’å±¥ã„ã¦ã‹ã‚‰ã€ãƒã‚±ãƒ„ã«å°‘ã—æ°´ã‚’å…¥ã‚Œã¾ã™ã€‚", key="r_t")
    text_responses["reading"] = f"è‡ªå·±è©•ä¾¡:{r_sel} / å›ç­”:{r_txt}"

with tab2:
    st.subheader("æ–‡ç« ä½œæˆåŠ›")
    w_sel = st.selectbox("è‡ªåˆ†ã®è€ƒãˆã‚’æ–‡ç« ã«ã™ã‚‹ã®ã¯å¾—æ„ã§ã™ã‹ï¼Ÿ", 
                           ["å¾—æ„", "æ™®é€š", "å°‘ã—è‹¦æ‰‹", "éå¸¸ã«è‹¦æ‰‹"], key="w_s")
    w_txt = st.text_area("ã‚ãªãŸãŒæœ€è¿‘çµŒé¨“ã—ãŸã€Œè‰¯ã„ã“ã¨ã€ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚", placeholder="3ã€œ5æ–‡ç¨‹åº¦ã§è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚", key="w_t")
    text_responses["writing"] = f"è‡ªå·±è©•ä¾¡:{w_sel} / å›ç­”:{w_txt}"

with tab3:
    st.subheader("è¨ˆç®—ãƒ»è«–ç†åŠ›")
    st.write("ã€èª²é¡Œã€‘1,200å††ã®å•†å“ã‚’è²·ã„ã€2,000å††å‡ºã—ã¾ã—ãŸã€‚ãŠé‡£ã‚Šã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ")
    c_sel = st.radio("è¨ˆç®—ã«è‡ªä¿¡ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", ["è¿·ã‚ãšè¨ˆç®—ã§ããŸ", "å°‘ã—æ™‚é–“ãŒã‹ã‹ã£ãŸ", "è¨ˆç®—æ©ŸãŒã»ã—ã„", "ã‚ã‹ã‚‰ãªã‹ã£ãŸ"], key="c_s")
    c_txt = st.text_area("ç­”ãˆã¨ã€ã‚‚ã—åˆ†ã‹ã‚Œã°è¨ˆç®—å¼ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚", placeholder="ä¾‹ï¼š800
